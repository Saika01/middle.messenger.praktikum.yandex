import './style.css';
import { Block } from './core/block';
import * as Components from './components';
import * as Pages from './pages';
import { setupFormValidation } from './core/validation';

type BlockClass = new (props?: any) => Block;

const pages: Record<string, [BlockClass, {[key:string]: Block | Object}]> = {
    login: [Pages.LoginPage, {
        loginInput: new Components.Input({
            type: 'text',
            label: '–õ–æ–≥–∏–Ω',
            name: 'login'
        }),
        passwordInput: new Components.Input({
            type: 'password',
            label: '–ü–∞—Ä–æ–ª—å',
            name: 'password'
        }),
        authButton: new Components.Button({
            type: 'confirm',
            text: '–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è',
            isSubmit: true
        }),
        registerButton: new Components.Button({
            type: 'cancel',
            text: '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞?'
        })
    }],
    signin: [Pages.SignInPage, {
        mailInput: new Components.Input({
            type: 'text',
            label: '–ü–æ—á—Ç–∞',
            name: 'email'
        }),
        loginInput: new Components.Input({
            type: 'text',
            label: '–õ–æ–≥–∏–Ω',
            name: 'login'
        }),
        firstNameInput: new Components.Input({
            type: 'text',
            label: '–ò–º—è',
            name: 'first_name'
        }),
        secondNamseInput: new Components.Input({
            type: 'text',
            label: '–§–∞–º–∏–ª–∏—è',
            name: 'second_name'
        }),
        phoneInput: new Components.Input({
            type: 'text',
            label: '–¢–µ–ª–µ—Ñ–æ–Ω',
            name: 'phone'
        }),
        passwordInput: new Components.Input({
            type: 'password',
            label: '–ü–∞—Ä–æ–ª—å',
            name: 'password'
        }),
        secondPassword: new Components.Input({
            type: 'password',
            label: '–ü–∞—Ä–æ–ª—å (–µ—â—ë —Ä–∞–∑)',
            name: ''
        }),
        registerButton: new Components.Button({
            type: 'confirm',
            text: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è',
            isSubmit: true
        }),
        logInButton: new Components.Button({
            type: 'cancel',
            text: '–í–æ–π—Ç–∏'
        })
    }],
    error500: [Pages.Error, {
        number: '500',
        message: '–ú—ã —É–∂–µ —Ñ–∏–∫—Å–∏–º',
    }],
    error404: [Pages.Error, {
        number: '404',
        message: '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫',
    }],
    chat: [Pages.Chat, {
        dialogues: [
            {
                name: '–í–∏–∫—Ç–æ—Ä',
                time: '16:30',
                isYou: false,
                message: '–í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ',
                isShowQuantity: false,
                quantity: 0,
                isCurrent: true,
            },
            {
                name: '–ê–ª–∏—Å–∞',
                time: '14:00',
                isYou: true,
                message: '–ö—É–ø–∏–ª–∞ –±–∏–ª–µ—Ç—ã –≤ –∫–∏–Ω–æ –Ω–∞ —Å—É–±–±–æ—Ç—É',
                isShowQuantity: false,
                quantity: 0,
                isCurrent: false,
            },
            {
                name: '–ö–∏–Ω–æ–∫–ª—É–±',
                time: '12:00',
                isYou: true,
                message: '—Å—Ç–∏–∫–µ—Ä',
                isShowQuantity: false,
                quantity: 999,
                isCurrent: false,
            },
            {
                name: '–°–µ—Ä–≥–µ–π',
                time: '11:30',
                isYou: true,
                message: '–ì–æ—Ç–æ–≤–æ!',
                isShowQuantity: true,
                quantity: 1,
                isCurrent: false,
            },
            {
                name: '–ê–Ω–¥—Ä–µ–π –ù–∏–∫–æ–ª–∞–µ–≤–∏—á –°–º–∏—Ä–Ω–æ–≤-–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π',
                time: '10:49',
                isYou: false,
                message: '–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –•–æ—Ç–µ–ª –æ–±—Å—É–¥–∏—Ç—å —Å –≤–∞–º–∏ –≤–∞–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å –∫–∞—Å–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—à–µ–≥–æ —Å–æ–≤–º–µ—Å—Ç–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è iOS –∏ Android. –ö–æ–≥–¥–∞ –≤–∞–º –±—É–¥–µ—Ç —É–¥–æ–±–Ω–æ —Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è?',
                isShowQuantity: true,
                quantity: 2,
                isCurrent: false,
            },
            {
                name: '–ú–∞—Ä–∏—è –ü–µ—Ç—Ä–æ–≤–Ω–∞',
                time: '–ü—Ç',
                isYou: false,
                message: '–î–æ–∫—É–º–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã, –º–æ–∂–µ—Ç–µ –∑–∞–±–∏—Ä–∞—Ç—å',
                isShowQuantity: true,
                quantity: 5,
                isCurrent: false,
            },
            {
                name: '–°–µ–º–µ–π–Ω—ã–π —á–∞—Ç',
                time: '–í—Å',
                isYou: true,
                message: '–ü—Ä–∏–µ–∑–∂–∞–µ–º –≤ –≥–æ—Å—Ç–∏ –≤ —Å–ª–µ–¥—É—é—â–µ–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ',
                isShowQuantity: true,
                quantity: 8,
                isCurrent: false,
            },
            {
                name: '–û–ª—å–≥–∞ –î–º–∏—Ç—Ä–∏–µ–≤–Ω–∞ (–±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è)',
                time: '–í—Ç',
                isYou: false,
                message: '–ü—Ä–æ—à—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ –¥–Ω—è –≤—Å–µ –æ—Ç—á–µ—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞ –∞–ø—Ä–µ–ª—å 2023 –≥–æ–¥–∞, –≤–∫–ª—é—á–∞—è –∞–∫—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç, —Å—á–µ—Ç–∞-—Ñ–∞–∫—Ç—É—Ä—ã –∏ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ. –≠—Ç–æ —Å—Ä–æ—á–Ω–æ –Ω—É–∂–Ω–æ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –≤ –Ω–∞–ª–æ–≥–æ–≤—É—é –∏–Ω—Å–ø–µ–∫—Ü–∏—é.',
                isShowQuantity: true,
                quantity: 999,
                isCurrent: false,
            },
            {
                name: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á –ü–µ—Ç—Ä–æ–≤-–í–æ–¥–∫–∏–Ω (–¥–∏—Ä–µ–∫—Ç–æ—Ä –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é)',
                time: '3 –ê–ø—Ä–µ–ª—è 2021',
                isYou: false,
                message: '–°—Ä–æ—á–Ω–æ! –°–µ–≥–æ–¥–Ω—è –≤ 14:30 –≤ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª–µ —Å–æ—Å—Ç–æ–∏—Ç—Å—è –≤–Ω–µ–æ—á–µ—Ä–µ–¥–Ω–æ–µ —Å–æ–±—Ä–∞–Ω–∏–µ —Å –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞–º–∏. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –ø–æ —Ç–µ–∫—É—â–∏–º –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–æ–≥–Ω–æ–∑–∞–º –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –∫–≤–∞—Ä—Ç–∞–ª. –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏—Ç–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π —á–∞—Å—Ç–∏.',
                isShowQuantity: true,
                quantity: 10,
                isCurrent: false,
            },
            {
                name: '–†–∞–±–æ—á–∏–π —á–∞—Ç',
                time: '1 –ú–∞—è 2020',
                isYou: false,
                message: '–°–µ–≥–æ–¥–Ω—è –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–π –¥–µ–Ω—å, –æ—Ñ–∏—Å –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç',
                isShowQuantity: false,
                quantity: 0,
                isCurrent: false,
            },
            {
                name: '–ì—Ä—É–ø–ø–∞ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞',
                time: '20 –î–µ–∫–∞–±—Ä—è 2019',
                isYou: false,
                message: '–ù–∞–ø–æ–º–∏–Ω–∞—é –æ –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–π –ª–µ–∫—Ü–∏–∏ –≤ 10:00',
                isShowQuantity: true,
                quantity: 100000,
                isCurrent: false,
            },
        ],
        isMock: false,
        talkingArea: new Components.TalkingArea({ talkingData: {
            name: '–í–∞—Å—è',
            messages: [
                {
                    isMine: false,
                    message: `–ü—Ä–∏–≤–µ—Ç! –°–º–æ—Ç—Ä–∏, —Ç—É—Ç –≤—Å–ø–ª—ã–ª –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –∫—É—Å–æ–∫ –ª—É–Ω–Ω–æ–π –∫–æ—Å–º–∏—á–µ—Å–∫–æ–π –∏—Å—Ç–æ—Ä–∏–∏ ‚Äî –ù–ê–°–ê –≤ –∫–∞–∫–æ–π-—Ç–æ –º–æ–º–µ–Ω—Ç –ø–æ–ø—Ä–æ—Å–∏–ª–∞ –•–∞—Å—Å–µ–ª—å–±–ª–∞–¥ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥–µ–ª—å SWC –¥–ª—è –ø–æ–ª–µ—Ç–æ–≤ –Ω–∞ –õ—É–Ω—É. –°–µ–π—á–∞—Å –º—ã –≤—Å–µ –∑–Ω–∞–µ–º —á—Ç–æ –∞—Å—Ç—Ä–æ–Ω–∞–≤—Ç—ã –ª–µ—Ç–∞–ª–∏ —Å –º–æ–¥–µ–ª—å—é 500 EL ‚Äî –∏ –∫ —Å–ª–æ–≤—É –≥–æ–≤–æ—Ä—è, –≤—Å–µ —Ç—É—à–∫–∏ —ç—Ç–∏—Ö –∫–∞–º–µ—Ä –≤—Å–µ –µ—â–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –õ—É–Ω—ã, —Ç–∞–∫ –∫–∞–∫ –∞—Å—Ç—Ä–æ–Ω–∞–≤—Ç—ã —Å —Å–æ–±–æ–π –∑–∞–±—Ä–∞–ª–∏ —Ç–æ–ª—å–∫–æ –∫–∞—Å—Å–µ—Ç—ã —Å –ø–ª–µ–Ω–∫–æ–π.

      –•–∞—Å—Å–µ–ª—å–±–ª–∞–¥ –≤ –∏—Ç–æ–≥–µ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–ª SWC –¥–ª—è –∫–æ—Å–º–æ—Å–∞, –Ω–æ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫ –∏ –Ω–∞ —Ä–∞–∫–µ—Ç—É –æ–Ω–∏ —Ç–∞–∫ –Ω–∏–∫–æ–≥–¥–∞ –∏ –Ω–µ –ø–æ–ø–∞–ª–∏. –í—Å–µ–≥–æ –∏—Ö –±—ã–ª–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–æ 25 —à—Ç—É–∫, –æ–¥–Ω—É –∏–∑ –Ω–∏—Ö –Ω–µ–¥–∞–≤–Ω–æ –ø—Ä–æ–¥–∞–ª–∏ –Ω–∞ –∞—É–∫—Ü–∏–æ–Ω–µ –∑–∞ 45000 –µ–≤—Ä–æ.`,
                    time: '11:56',
                },
                {
                    isMine: true,
                    message: '–í–∞—É, –Ω–µ –∑–Ω–∞–ª –æ–± —ç—Ç–æ–º! –ü–æ–ª—É—á–∞–µ—Ç—Å—è, —ç—Ç–∏ –∫–∞–º–µ—Ä—ã —Ç–∞–∫ –∏ –æ—Å—Ç–∞–ª–∏—Å—å –Ω–∞ –õ—É–Ω–µ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã?',
                    time: '11:58',
                },
                {
                    isMine: false,
                    message: '–ò–º–µ–Ω–Ω–æ —Ç–∞–∫! 12 –∫–∞–º–µ—Ä –¥–æ —Å–∏—Ö –ø–æ—Ä —Ç–∞–º. –ö—Å—Ç–∞—Ç–∏, —É NASA –¥–∞–∂–µ –µ—Å—Ç—å –∏—Ö —Ç–æ—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.',
                    time: '12:01',
                },
                {
                    isMine: true,
                    message: '–ê –ø–æ—á–µ–º—É –æ–Ω–∏ –Ω–µ –∑–∞–±—Ä–∞–ª–∏ –∫–∞–º–µ—Ä—ã? –í–µ—Å —ç–∫–æ–Ω–æ–º–∏–ª–∏?',
                    time: '12:03',
                },
                {
                    isMine: false,
                    message: '–î–∞, –∫–∞–∂–¥—ã–π –≥—Ä–∞–º–º –Ω–∞ —Å—á–µ—Ç—É. –õ—É–Ω–Ω—ã–π –º–æ–¥—É–ª—å –∏–º–µ–ª –∂—ë—Å—Ç–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –º–∞—Å—Å–µ. –ù–æ –ø–ª–µ–Ω–∫–∞, –∫–æ–Ω–µ—á–Ω–æ, –±—ã–ª–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º üòä',
                    time: '12:05',
                },
                {
                    isMine: true,
                    message: '–°–æ—Ä—è–Ω, –æ–ø–∞–∑–¥—ã–≤–∞—é –Ω–∞ –≤—Å—Ç—Ä–µ—á—É! –ü—Ä–æ–¥–æ–ª–∂–∏–º –ø–æ–∑–∂–µ?',
                    time: '12:07',
                },
                {
                    isMine: false,
                    message: '–ö–æ–Ω–µ—á–Ω–æ! –ö–∞–∫ —Ä–∞–∑ –Ω–∞–π–¥—É —Ç–µ–±–µ —Ñ–æ—Ç–æ —Ç–æ–π –∞—É–∫—Ü–∏–æ–Ω–Ω–æ–π –∫–∞–º–µ—Ä—ã. –£–¥–∞—á–∏ –Ω–∞ –≤—Å—Ç—Ä–µ—á–µ!',
                    time: '12:08',
                },
                {
                    isMine: true,
                    message: 'üëç',
                    time: '12:08',
                },
            ],
        }})
    }],
    userProfile: [Pages.Profile, {
        photo: false,
        name: '–ò–≤–∞–Ω',
        profileDescription: [
            {
                attribute: '–ü–æ—á—Ç–∞',
                value: 'pochta@yandex.ru',
            },
            {
                attribute: '–õ–æ–≥–∏–Ω',
                value: 'ivanivanov',
            },
            {
                attribute: '–ò–º—è',
                value: '–ò–≤–∞–Ω',
            },
            {
                attribute: '–§–∞–º–∏–ª–∏—è',
                value: '–ò–≤–∞–Ω–æ–≤',
            },
            {
                attribute: '–ò–º—è –≤ —á–∞—Ç–µ',
                value: '–ò–≤–∞–Ω',
            },
            {
                attribute: '–¢–µ–ª–µ—Ñ–æ–Ω',
                value: '+7 (909) 967 30 30',
            },
        ],
        changeDataButton: new Components.Button({
            type: 'line',
            text: '–ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ',
            color: 'blue'
        }),
        changePasswordButton: new Components.Button({
            type: 'line',
            text: '–ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å',
            color: 'blu'
        }),
        logoutButton: new Components.Button({
            type: 'line',
            text: '–í—ã–π—Ç–∏',
            color: 'red'
        })
    }],
    changeUserProfile: [Pages.ChangeProfile, {
        photo: false,
        name: '–ò–≤–∞–Ω',
        profileDescription: [
            {
                input: new Components.Input({
                    type: 'text',
                    attribute: '–ü–æ—á—Ç–∞',
                    name: 'email',
                }),
                value: 'pochta@yandex.ru',
            },
            {
                input: new Components.Input({
                    type: 'text',
                    attribute: '–õ–æ–≥–∏–Ω',
                    name: 'login',
                }),
                value: 'ivanivanov',
            },
            {
                input: new Components.Input({
                    type: 'text',
                    attribute: '–ò–º—è',
                    name: 'first_name',
                }),
                value: '–ò–≤–∞–Ω',
            },
            {
                input: new Components.Input({
                    type: 'text',
                    attribute: '–§–∞–º–∏–ª–∏—è',
                    name: 'second_name',
                }),
                value: '–ò–≤–∞–Ω–æ–≤',
            },
            {
                input: new Components.Input({
                    type: 'text',
                    attribute: '–ò–º—è –≤ —á–∞—Ç–µ',
                    name: 'display_name',
                }),
                value: '–ò–≤–∞–Ω',
            },
            {
                input: new Components.Input({
                    type: 'text',
                    attribute: '–¢–µ–ª–µ—Ñ–æ–Ω',
                    name: 'phone',
                }),
                value: '+7 (909) 967 30 30',
            },
        ],
        avatarInput: new Components.Input({
            type: 'file',
            label: '–í—ã–±—Ä–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
            name: 'avatar'
        }),
        saveButton: new Components.Button({
            type: 'confirm',
            text: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
            isSubmit: true
        })
    }],
    changePassword: [Pages.ChangePassword, {
        oldPasswordInput: new Components.Input({
            type: 'password',
            label: '–°—Ç–∞—Ä—ã–π –ø–∞—Ä–æ–ª—å',
            name: 'oldPassword'
        }),
        newPasswordInput: new Components.Input({
            type: 'password',
            label: '–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å',
            name: 'newPassword'
        }),
        saveButton: new Components.Button({
            type: 'confirm',
            text: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å',
            isSubmit: true
        })
    }],
    navigation: [Pages.Navigation, {
        pages: [
            {
                systemName: 'login',
                readableName: 'Login',
            },
            {
                systemName: 'signin',
                readableName: 'Sign-in',
            },
            {
                systemName: 'error404',
                readableName: '404',
            },
            {
                systemName: 'error500',
                readableName: '500',
            },
            {
                systemName: 'chat',
                readableName: 'Messages',
            },
            {
                systemName: 'userProfile',
                readableName: 'Profile',
            },
            {
                systemName: 'changeUserProfile',
                readableName: 'Change user information',
            },
            {
                systemName: 'changePassword',
                readableName: 'Change password',
            },
        ],
    }],
};

function navigate(page: string) {
    const [PageClass, props] = pages[page];
    const pageInstance = new PageClass(props);

    const container = document.getElementById('app')!;
    container.innerHTML = '';
    const content = pageInstance.getContent()!;
    container.appendChild(content);

    const form = content.querySelector('form');
    if (form) {
        setupFormValidation(content.querySelector('form') as HTMLFormElement);
    }
}

document.addEventListener('DOMContentLoaded', () => navigate('navigation'));

document.addEventListener('click', (e) => {
    const { target } = e;
    if (!(target instanceof HTMLElement)) {
        return;
    }

    const page = target.closest('a')?.getAttribute('page');
    if (page) {
        navigate(page);

        e.preventDefault();
        e.stopImmediatePropagation();
    }
});
